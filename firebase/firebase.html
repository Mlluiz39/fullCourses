<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous"
    />
    <title>firebase</title>
  </head>
  <body>
    <div class="container">
      <h1 class="text-center mt-3">DB Firebase</h1>
      <form class="mt-5">
        <div class="mb-3">
          <label class="form-label">Id</label>
          <input type="text" class="form-control" id="input-id" />
        </div>
        <div class="mb-3">
          <div class="row">
            <div class="col">
              <label for="exampleFirstName" class="form-label mt-3">Nome</label>
              <input
                type="text"
                class="form-control"
                id="first-name-box"
                aria-label="First name"
              />
            </div>
            <div class="col">
              <label for="exampleInputLastName" class="form-label mt-3"
                >Sobrenome</label
              >
              <input
                type="text"
                class="form-control"
                id="last-name-box"
                aria-label="Last name"
              />
            </div>
          </div>
          <select
            class="form-select form-select-sm mb-3 mt-5"
            id="gender-box"
            aria-label=".form-select-sm example"
          >
            <option value="1">Masculino</option>
            <option value="2">Feminino</option>
          </select>
          <label for="exampleInputEmail1" class="form-label mt-3">Email</label>
          <input
            type="email"
            class="form-control"
            id="input-email"
            aria-describedby="emailHelp"
          />
          <div id="emailHelp" class="form-text">
            Não expomos seus dados de login.
          </div>
        </div>
        <div class="mb-3">
          <label for="exampleInputPassword1" class="form-label">Senha</label>
          <input type="password" class="form-control" id="input-password" />
        </div>
        <button class="btn btn-success" id="btn-insert">Insert</button>
        <button class="btn btn-primary" id="btn-select">Select</button>
        <button class="btn btn-warning" id="btn-update">Update</button>
        <button class="btn btn-danger" id="btn-delete">Delete</button>
      </form>
    </div>

    <!--- Importação e configuração -->

    <script type="module">
      // Import the functions you need from the SDKs you need
      import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.6.6/firebase-app.js'
      // TODO: Add SDKs for Firebase products that you want to use
      // https://firebase.google.com/docs/web/setup#available-libraries

      // Your web app's Firebase configuration
      const firebaseConfig = {
        apiKey: 'AIzaSyDLp8koCRLqA4wYl2DszjjhZpgH-DC7NU0',
        authDomain: 'fire9db-3d0c5.firebaseapp.com',
        projectId: 'fire9db-3d0c5',
        storageBucket: 'fire9db-3d0c5.appspot.com',
        messagingSenderId: '468590543639',
        appId: '1:468590543639:web:101b87c19bcc7aaf566d52',
        measurementId: 'G-FJTD696PJQ',
      }

      // Initialize Firebase
      const app = initializeApp(firebaseConfig)

      import {
        getDatabase,
        ref,
        get,
        set,
        child,
        update,
        remove,
      } from 'https://www.gstatic.com/firebasejs/9.6.6/firebase-database.js'

      const db = getDatabase()

      // Referencias //
      const idBox = document.getElementById('input-id')
      const nameBox = document.getElementById('first-name-box')
      const lastNameBox = document.getElementById('last-name-box')
      const genderBox = document.getElementById('gender-box')
      const emailBox = document.getElementById('input-email')
      const passBox = document.getElementById('input-password')

      const btnInsert = document.getElementById('btn-insert')
      const btnSelect = document.getElementById('btn-select')
      const btnUpdate = document.getElementById('btn-update')
      const btnDelete = document.getElementById('btn-delete')

      btnInsert.addEventListener('click', e => {
        e.preventDefault()
        idBox.value = idBox.value.trim()
        nameBox.value = nameBox.value.trim()
        lastNameBox.value = lastNameBox.value.trim()
        genderBox.value = genderBox.value.trim()
        emailBox.value = emailBox.value.trim()
        passBox.value = passBox.value.trim()

        function insertData() {
          set(ref(db, 'users/' + idBox.value), {
            id: idBox.value,
            name: nameBox.value,
            lastName: lastNameBox.value,
            gender: genderBox.value,
            email: emailBox.value,
            password: passBox.value,
          })
            .then(() => {
              alert('banco de dados criado com sucesso!')
            })
            .catch(error => {
              alert('Erro ao criar banco de dados:' + error)
            })
        }

        insertData()
        idBox.value = ''
        nameBox.value = ''
        lastNameBox.value = ''
        genderBox.value = ''
        emailBox.value = ''
        passBox.value = ''
      })

      btnSelect.addEventListener('click', e => {
        e.preventDefault()
        idBox.value = idBox.value.trim()
        nameBox.value = nameBox.value.trim()
        lastNameBox.value = lastNameBox.value.trim()
        genderBox.value = genderBox.value.trim()
        emailBox.value = emailBox.value.trim()
        passBox.value = passBox.value.trim()

        function selectData() {
          get(ref(db, 'users/' + idBox.value)).then(snapshot => {
            if (snapshot.val()) {
              idBox.value = snapshot.val().id
              nameBox.value = snapshot.val().name
              lastNameBox.value = snapshot.val().lastName
              genderBox.value = snapshot.val().gender
              emailBox.value = snapshot.val().email
              passBox.value = snapshot.val().password
            }
          })
        }

        selectData()
      })

      btnUpdate.addEventListener('click', e => {
        e.preventDefault()
        idBox.value = idBox.value.trim()
        nameBox.value = nameBox.value.trim()
        lastNameBox.value = lastNameBox.value.trim()
        genderBox.value = genderBox.value.trim()
        emailBox.value = emailBox.value.trim()
        passBox.value = passBox.value.trim()

        function updateData() {
          update(ref(db, 'users/' + idBox.value), {
            id: idBox.value,
            name: nameBox.value,
            lastName: lastNameBox.value,
            genderBox: genderBox.value,
            email: emailBox.value,
            password: passBox.value,
          })
            .then(() => {
              alert('banco de dados atualizado com sucesso!')
            })
            .catch(error => {
              alert('Erro ao atualizar banco de dados:' + error)
            })
        }
        updateData()
      })

      btnDelete.addEventListener('click', e => {
        e.preventDefault()
        idBox.value = idBox.value.trim()
        nameBox.value = nameBox.value.trim()
        lastNameBox.value = lastNameBox.value.trim()
        genderBox.value = genderBox.value.trim()
        emailBox.value = emailBox.value.trim()
        passBox.value = passBox.value.trim()

        function deleteData() {
          remove(ref(db, 'users/' + idBox.value))
            .then(() => {
              alert('banco de dados deletado com sucesso!')
            })
            .catch(error => {
              alert('Erro ao deletar banco de dados:' + error)
            })
        }

        deleteData()
      })
    </script>
  </body>
</html>
